!function(){"use strict";console.log("[Anchor Nav] Script loaded");const e={};function t(n,o){if(e[o])return e[o];if(n.URL===o){const t=[];if(n.Children&&n.Children.length>0)for(const e of n.Children)if(e.URL&&e.URL.includes("#")){const n=e.URL.split("#")[1];n&&t.push({id:n,title:e.Title||n})}return e[o]=t,t}if(n.Children&&n.Children.length>0)for(const e of n.Children){const n=t(e,o);if(n.length>0)return n}return[]}function n(){if("undefined"==typeof rootDb)return console.warn("[Anchor Nav] rootDb not loaded"),[],[];let e=window.location.pathname;e.startsWith("/")&&(e=e.substring(1)),console.log("[Anchor Nav] Looking up:",e);const n=t(rootDb,e);return 0===n.length?console.log("[Anchor Nav] No anchors defined for this page"):console.log("[Anchor Nav] Found",n.length,"anchors"),n}function o(e,t){const n=document.getElementById(e);if(n){const e=(n.querySelector("h1, h2, h3, h4, h5, h6")||n).textContent.trim();if(e&&e.length>0)return e}return t}function r(){const e=document.getElementById("anchor-nav-container");if(!e)return console.warn("[Anchor Nav] Container not found"),!1;const t=n();if(0===t.length){console.log("[Anchor Nav] Hiding anchor nav (no anchors)"),e.style.display="none";const t=document.getElementById("anchor-nav-toggle");return t&&(t.style.display="none"),!1}console.log("[Anchor Nav] Rendering",t.length,"anchors"),e.style.display="block";let r="On This Page";const a=document.querySelector("title");if(a){const e=a.textContent;r=e.replace(/\s*\|\s*HISE.*$/,"").trim()}if(!r||"HISE"===r){const e=document.querySelector("h1");e&&(r=e.textContent.trim())}let l='<div class="anchor-nav-header">';l+='<a href="#" class="anchor-nav-page-title" data-anchor="top">'+r+"</a>",l+='</div><ul class="anchor-nav-list">',t.forEach(e=>{const t=e.title||o(e.id,e.id);l+=`<li class="anchor-nav-item"><a href="#${e.id}" data-anchor="${e.id}" class="anchor-nav-link">${t}</a></li>`}),l+="</ul>",e.innerHTML=l,console.log("[Anchor Nav] Rendered successfully"),i(),c(t.map(e=>e.id));return!0}let a=!1;function i(){if(a)return;const e=document.getElementById("anchor-nav-container");e&&(e.addEventListener("click",function(e){const t=e.target.closest(".anchor-nav-link, .anchor-nav-page-title");if(!t)return;e.preventDefault();const n=t.getAttribute("data-anchor");if("top"===n)return window.scrollTo({top:0,behavior:"smooth"}),void history.pushState(null,null,window.location.pathname+window.location.search);const o=document.getElementById(n);if(o){o.scrollIntoView({behavior:"smooth",block:"start"});const e=window.location.pathname+window.location.search;history.pushState(null,null,e+"#"+n)}}),a=!0,console.log("[Anchor Nav] Smooth scroll enabled"))}let l=null;function c(e){l&&(l.disconnect(),l=null);const t=e.map(e=>document.getElementById(e)).filter(Boolean);if(0===t.length)return void console.warn("[Anchor Nav] No anchor elements found in DOM");const n=new Set;l=new IntersectionObserver(t=>{t.forEach(e=>{const t=e.target.id;e.isIntersecting?n.add(t):n.delete(t)}),d(n,e)},{rootMargin:"-80px 0px -70% 0px",threshold:0}),t.forEach(e=>{l.observe(e)})}let s=null,u=null;function d(e,t){s||(s=setTimeout(function(){s=null;let n=null;for(const o of t)if(e.has(o)){n=o;break}if(!n&&t.length>0){(window.pageYOffset||document.documentElement.scrollTop)<200&&(n=t[0])}if(n!==u){const e=document.querySelectorAll(".anchor-nav-link");if(e.forEach(e=>e.classList.remove("active")),n){const e=document.querySelector(`.anchor-nav-link[data-anchor="${n}"]`);e&&e.classList.add("active")}u=n}},100))}let g=!1;function h(){"undefined"!=typeof rootDb&&(console.log("[Anchor Nav] Initializing"),r()&&function(){const e=document.getElementById("anchor-nav-container");if(!e)return;let t=document.getElementById("anchor-nav-toggle");t||(t=document.createElement("button"),t.id="anchor-nav-toggle",t.setAttribute("aria-label","Toggle anchor navigation"),document.body.appendChild(t)),t.style.display="block";let n=document.getElementById("anchor-nav-backdrop");n||(n=document.createElement("div"),n.id="anchor-nav-backdrop",document.body.appendChild(n));let o=document.getElementById("anchor-nav-dropdown");function r(e){e&&(e.preventDefault(),e.stopPropagation());const t=document.getElementById("anchor-nav-dropdown"),o=document.getElementById("anchor-nav-backdrop");if(!t||!o)return void console.error("[Anchor Nav] Dropdown or backdrop element not found");const r=t.classList.contains("open");r?(t.classList.remove("open"),o.classList.remove("open")):(t.classList.add("open"),o.classList.add("open")),console.log("[Anchor Nav] Mobile drawer toggled:",!r)}o||(o=document.createElement("div"),o.id="anchor-nav-dropdown",document.body.appendChild(o)),o.innerHTML=e.innerHTML,g||(t.addEventListener("click",r),n.addEventListener("click",function(e){e.preventDefault(),r()}),o.addEventListener("click",function(e){const t=e.target.closest(".anchor-nav-link, .anchor-nav-page-title");if(t){e.preventDefault();const n=t.getAttribute("data-anchor"),o=document.getElementById("anchor-nav-dropdown"),r=document.getElementById("anchor-nav-backdrop");o&&o.classList.remove("open"),r&&r.classList.remove("open"),setTimeout(function(){if("top"===n){window.scrollTo({top:0,behavior:"smooth"});const e=window.location.pathname+window.location.search;history.pushState(null,null,e)}else{const e=document.getElementById(n);if(e){e.scrollIntoView({behavior:"smooth",block:"start"});const t=window.location.pathname+window.location.search;history.pushState(null,null,t+"#"+n)}}},100)}}),g=!0,console.log("[Anchor Nav] Mobile drawer initialized")),console.log("[Anchor Nav] Mobile drawer content updated")}())}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",h):h()}();